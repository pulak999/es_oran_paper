\begin{algorithm} [t!]
    % \small
\caption{\texttt{\sysname encryption flow}, \textit{Input:} Ingress encrypted packet \textsf{pkt}, Keys \textsf{k1, k2} configured by control plane into MATs, Nonces \textsf{n1, n2}, Associated data \textsf{ad}, \textit{Output:} \textsf{new\_pkt} 
% \todo{modify this}
}
    \begin{algorithmic} [1]
    % (\textsf{pkt}.src\_ip, \textsf{pkt}.dst\_ip)
        \State \textsf{initstateVec} $\gets$ \textsf{k1, k2, n1, n2, IV}
        \State $round\_num \gets 0$
        \Procedure {p\_rnd} {round\_num, \textsf{stVec}}
                \State \textsf{stVec} $\gets const\_addition(round\_num, \textsf{stVec})$
                \State \textsf{stVec} $\gets substitution\_1(\textsf{stVec})$
                \State \textsf{stVec} $\gets substitution\_keccak\_box(\textsf{stVec})$
                \State \textsf{stVec} $\gets linear\_diffusion(\textsf{stVec})$
                \State $round\_num \gets round\_num + 1$
                \State \Return \textsf{stVec}
        \EndProcedure
        \\

        \If{ $(round\_num \leq 12)$} \COMMENT{Initialization}
            \State \Call{p\_rnd} {round\_num, \textsf{initstateVec}} 
        \ElsIf{$(round\_num \leq 12 + 6* (ad\_len/8))$} 
        % \COMMENT{AD Absorption}
                \State $\textsf{stVec} \gets absorb\_ad(\textsf{stVec}, ad)$
                \State \Call{p\_rnd} {round\_num, \textsf{stVec}}
        \ElsIf{($round\_num\leq  12+6*(ad\_len/8)+6*(\textsf{pkt}.payload\_len/8))$} 
        % \COMMENT{Payload Absorption}
                \State $\textsf{stVec} \gets absorb\_pt(\textsf{stVec}, \textsf{pkt}.payload)$
                \State \Call{p\_rnd} {round\_num, \textsf{stVec}}
        \ElsIf{($round\_num == 12 +6*(ad\_len/8)+6*(\textsf{pkt}.payload\_len/8))$}
                \State $ciph\_text \gets \textsf{stVec}$
        \ElsIf{($round\_num \leq  24 +6*(ad\_len/8)+6*(\textsf{pkt}.payload\_len/8))$} 
        \COMMENT{Finalization}
                \State \Call{p\_rnd} {round\_num, \textsf{stVec}}
        
        \Else \COMMENT{Tag Finalization}
                \State $tags \gets \textsf{stVec}$
                \State $\textsf{new\_pkt}.append(ciph\_text, tags) $
                
        \EndIf
        //
        
        \State \Call{forward} {\textsf{new\_pkt}}
    \end{algorithmic}
    \label{alg:pipeline}
\end{algorithm}

 % \If {(cCount - \textsf{cms}.get\_count(flowId)) > $\sigma$} \label{algorithm_access_check_count_start}
 %                \State \textsf{pkt}.ctrl $\gets 0$ \COMMENT{prepare alert}
 %                \State \textsf{pkt}.dst\_ip $\gets$ \Call {Get\_Border\_IP}{\textsf{pkt}.ctrl.borderId}\label{algorithm_access_check_count_end}